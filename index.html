<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFinancial | Car Insurance Survey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Dropdown focus styling */
        select:focus {
            border-color: pink;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 192, 203, 0.4);
        }

        /* Fade-in animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Hidden by default */
        .form-step {
            opacity: 0;
            display: none;
            transition: opacity 0.5s ease-in-out;
        }

        /* Visible step */
        .form-step.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        /* Blue done icon styles */
        .done-icon {
    display: inline-block;
    width: 24px;
    height: 24px;
    background-color: #1E90FF;
    border-radius: 50%;
    color: white;
    text-align: center;
    line-height: 24px;
    margin-right: 10px;
}

        .done-icon::after {
            content: '✔';
        }

        /* Form group layout for alignment */
        .form-group {
            margin-bottom: 1.2rem;
        }

        /* Uniform dropdown size and style */
        .custom-dropdown {
            width: 100%;
        }

        .form-container {
            margin: 0 auto;
            padding: 20px;
            max-width: 600px;
            box-shadow: none;
        }

        .question-title {
    font-size: 1.25rem; /* Reduced from 1.5rem */
    font-weight: bold;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.form-label {
    font-size: 0.9rem; /* Reduced from 1rem */
    font-weight: 600;
    margin-bottom: 10px;
}

.radio-label {
    margin-left: 25px;
    font-size: 0.9rem; /* Reduced from 1rem */
    font-weight: 500;
}

        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1.1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
            appearance: none;
        }

        .question-step {
            margin-bottom: 30px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            display: none;
        }

        .question-step.active {
            display: block;
            opacity: 1;
        }

        .question-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .radio-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: calc(50% - 10px);
            padding: 15px;
            background-color: #f1f1f1;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            position: relative;
            text-align: center;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .radio-button.selected {
            background-color: #ff0080;
            color: white;
        }

        .radio-button input[type="radio"] {
            display: none;
        }

        .radio-button input[type="radio"] + span {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 20px;
            height: 20px;
        }

        .radio-button.selected input[type="radio"] + span::before {
            content: '';
            display: block;
            background-color: white;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ff0080;
        }

        .radio-label {
            margin-left: 25px;
            font-size: 1rem;
            font-weight: 500;
        }

        /* Responsive fix for small screens */
        @media (max-width: 640px) {
            .radio-button {
                width: 100%;
            }
        }
   /* Next Step Button Styles */
.next-step-button {
    display: none; /* Ensure it's hidden initially */
    background-color: #0080ff;
    color: white;
    padding: 20px 40px;
    border-radius: 5px;
    border: none;
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
    margin: 30px auto;
    text-align: center;
}

.next-step-button.show {
    display: block; /* Show when 'show' class is added */
}

/* Navigation Link Styles */
.nav-link {
    position: relative;
    color: #4a5568; /* text-gray-700 */
    transition: color 0.3s;
}

.nav-link.active {
    color: #ff0080; /* Pink color */
    font-weight: bold;
}

.nav-link .nav-icon {
    font-size: 1rem;
    margin-right: 5px;
    color: #ff0080; /* Pink color */
}

/* Hover effect */
.nav-link:hover {
    color: #000000; /* text-black */
}

/* Ensure the icon aligns with the text */
.nav-link .nav-icon {
    vertical-align: middle;
}

/* Adjust the spacing */
.nav-link span {
    display: inline-block;
    vertical-align: middle;
}

#dob-form {
    opacity: 0;
    animation: fadeIn 0.5s ease-in-out forwards;
    animation-delay: 0.2s; /* Optional delay */
}
/* Name Input Styles */
.name-input {
    font-size: 1.25rem;
    padding: 10px;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    width: 100%;
}

.name-input:focus {
    border-color: #ff0080;
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 0, 128, 0.2);
}

.name-input.error {
    border-color: red;
}
.stage {
    text-align: center;
}

    </style>
</head>
<body>

<!-- Header Section -->
<header class="bg-white shadow-md py-4">
    <div class="container mx-auto flex justify-between items-center px-4 lg:px-0">
      
      <!-- Logo Section -->
      <div class="logo">
        <img src="./public/assets/sflogo.png" alt="Logo" class="h-8 lg:h-10">
      </div>
      
      <!-- Contact Info Section -->
      <div class="contact-info flex items-center text-gray-600 text-sm lg:text-lg">
        <i class="fas fa-phone text-black mr-2"></i>
        <span class="whitespace-nowrap">Need help? Talk to an agent 
          <strong class="text-black">855-581-3316</strong>
        </span>
      </div>
      
    </div>
  </header>
  

<section class="bg-gray-100 py-10 text-center">
    <div class="container mx-auto flex flex-col items-center px-4">
      
      <!-- Car Image Section -->
      <div class="car mb-5">
        <img src="./public/assets/car.png" alt="Car Image" class="h-16 md:h-20">
      </div>
      
      <!-- Heading Section -->
      <h1 class="text-xl md:text-2xl font-bold text-gray-800 leading-tight max-w-xl">
        Hello, Let's see how much we can save you on car insurance.
      </h1>
      
    </div>
  </section>
  


<!-- Navigation Tabs with Progress Bar -->
  <!-- Navigation Bar -->
  <nav class="bg-white border-t border-gray-200 shadow-sm">
    <div class="container mx-auto flex justify-center py-5">
        <a href="#" id="nav-vehicles" class="nav-link mx-5 text-sm font-semibold text-gray-700 hover:text-black">
            <span class="nav-icon" id="nav-icon-vehicles" style="display: none;">✔</span>
            Vehicles
        </a>
        <a href="#" id="nav-drivers" class="nav-link mx-5 text-sm font-semibold text-gray-700 hover:text-black">
            Drivers
        </a>
        <a href="#" id="nav-final-details" class="nav-link mx-5 text-sm font-semibold text-gray-700 hover:text-black">Final Details</a>
        <a href="#" id="nav-quotes" class="nav-link mx-5 text-sm font-semibold text-gray-700 hover:text-black">Quotes</a>
    </div>
    <div class="w-full bg-gray-200 h-1">
        <div id="progress-bar" class="bg-pink-500 h-1" style="width: 14%;"></div>
    </div>
</nav>

<div id="stage-vehicles" class="stage">
    <div class="container mx-auto p-4 max-w-screen-lg">
        <!-- First vehicle form -->
        <form id="vehicle-form" class="bg-white p-10 form-container">
            <div class="form-group">
                <h2 class="question-title">
                    <div class="done-icon" id="main-done-icon" style="display:none;"></div>
                    Let's get started, what car do you drive?
                </h2>
            </div>
    
            <!-- Vehicle Year Dropdown -->
            <div class="form-group">
                <label for="vehicle-year" class="form-label">Select Vehicle Year</label>
                <div class="custom-dropdown">
                    <select id="vehicle-year" name="vehicle-year" class="form-select">
                        <option value="">Select Vehicle Year</option>
                        <!-- Years populated dynamically -->
                    </select>
                </div>
            </div>
    
            <!-- Vehicle Make Dropdown -->
            <div id="step-2" class="form-step">
                <div class="form-group">
                    <label for="vehicle-make" class="form-label">Select Vehicle Make</label>
                    <div class="custom-dropdown">
                        <select id="vehicle-make" name="vehicle-make" class="form-select">
                            <option value="">Select Vehicle Make</option>
                            <!-- Makes populated dynamically -->
                        </select>
                    </div>
                </div>
            </div>
    
            <!-- Vehicle Model Dropdown -->
            <div id="step-3" class="form-step">
                <div class="form-group">
                    <label for="vehicle-model" class="form-label">Select Vehicle Model</label>
                    <div class="custom-dropdown">
                        <select id="vehicle-model" name="vehicle-model" class="form-select">
                            <option value="">Select Vehicle Model</option>
                            <!-- Models populated dynamically -->
                        </select>
                    </div>
                </div>
            </div>
        </form>
    
        <!-- Dynamic Questions Section -->
        <form id="dynamic-questions-form" class="survey-form">
            <div id="questions-container"></div>
        </form>
    
        
    
 

    </div>
</div>
<!-- Drivers Stage -->
<div id="stage-drivers" class="stage" style="display: none;">
    <!-- Name Form -->
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md mx-auto mt-10" id="name-form">
        <!-- Title and subtitle -->
        <h2 class="question-title text-2xl font-semibold text-center mb-2">
            <div class="done-icon" id="name-done-icon" style="display: none;"></div>
            What is your name?
        </h2>
        <p class="text-gray-500 text-center mb-6">The better we know you, the more accurate quotes we can provide</p>

        <!-- First Name and Last Name Input Fields -->
        <div>
            <div class="mb-4">
                <input type="text" id="first-name" name="first_name" placeholder="First Name" class="name-input w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 placeholder-gray-400">
            </div>
            <div class="mb-4">
                <input type="text" id="last-name" name="last_name" placeholder="Last Name" class="name-input w-full px-4 py-3 text-lg border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 placeholder-gray-400">
            </div>
        </div>
    </div>

    <!-- Date of Birth Form (Initially Hidden) -->
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md mx-auto mt-10" id="dob-form" style="display: none;">
        <!-- Title -->
        <h2 class="question-title text-2xl font-semibold text-center mb-4">
            <div class="done-icon" id="dob-done-icon" style="display: none;"></div>
            What is your date of birth?
        </h2>

        <!-- Date of Birth Input -->
        <div class="dob-input-container flex items-center justify-between border border-gray-300 rounded-lg p-4">
            <!-- Month Input -->
            <input type="text" id="dob-month" placeholder="MM" maxlength="2" class="dob-input w-1/4 text-center text-gray-500 focus:outline-none focus:ring-2 focus:ring-pink-500 rounded-md text-lg">
            
            <!-- Separator -->
            <span class="text-lg text-gray-400">/</span>
            
            <!-- Day Input -->
            <input type="text" id="dob-day" placeholder="DD" maxlength="2" class="dob-input w-1/4 text-center text-gray-500 focus:outline-none focus:ring-2 focus:ring-pink-500 rounded-md text-lg">
            
            <!-- Separator -->
            <span class="text-lg text-gray-400">/</span>
            
            <!-- Year Input -->
            <input type="text" id="dob-year" placeholder="YYYY" maxlength="4" class="dob-input w-1/4 text-center text-gray-500 focus:outline-none focus:ring-2 focus:ring-pink-500 rounded-md text-lg">
        </div>
    </div>

    <!-- Next Step Button -->
    <div class="next-step-container">
        <button id="next-step-button-drivers" class="next-step-button">Next Step</button>
    </div>
</div>

    <!-- Next Step Button -->
    
    <div class="next-step-container">
        <button id="next-step-button" class="next-step-button">Next Step</button>
    </div>
    <!-- Next Step Button for Drivers Stage -->
<div class="next-step-container">
    <button id="next-step-button-drivers" class="next-step-button">Next Step</button>
</div>
<!-- Container for the form content -->

<script>
    function scrollToElement(element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    // Declare variables to store data
    let carData = null;
    let questionsData = null;
    let data = {
        vehicle1: {},
        answers1: {},
        // vehicle2 and answers2 will be added when needed
        driver: {}
    };

    // Get the next step button and make it accessible globally
    const nextStepButton = document.getElementById('next-step-button');
    // Stage Containers
const stageVehicles = document.getElementById('stage-vehicles');
const stageDrivers = document.getElementById('stage-drivers');

// Navigation elements
const navVehicles = document.getElementById('nav-vehicles');
const navIconVehicles = document.getElementById('nav-icon-vehicles');
const navDrivers = document.getElementById('nav-drivers');
let navIconDrivers = document.getElementById('nav-icon-drivers');

// Get the next step buttons
const nextStepButtonVehicles = document.getElementById('next-step-button');
const nextStepButtonDrivers = document.getElementById('next-step-button-drivers');
const nameForm = document.getElementById('name-form');
const firstNameInput = document.getElementById('first-name');
const lastNameInput = document.getElementById('last-name');
const nameDoneIcon = document.getElementById('name-done-icon');
function showStage(stage) {
    // Hide all stages
    document.querySelectorAll('.stage').forEach(stageDiv => {
        stageDiv.classList.remove('active');
        stageDiv.style.display = 'none';
    });

    // Show the selected stage
    switch (stage) {
        case 'vehicles':
            stageVehicles.classList.add('active');
            stageVehicles.style.display = 'block';
            updateNavigation('vehicles');
            break;
        case 'drivers':
            stageDrivers.classList.add('active');
            stageDrivers.style.display = 'block';
            updateNavigation('drivers');
            break;
        // Add cases for additional stages if needed
        default:
            break;
    }
}

// Function to update navigation bar
function updateNavigation(currentStage) {
    // Remove 'active' class from all nav links
    document.querySelectorAll('.nav-link').forEach(navLink => {
        navLink.classList.remove('active');
    });

    // Update progress bar width based on the current stage
    const progressBar = document.getElementById('progress-bar');
    let progressWidth = '14%'; // Default progress width

    switch (currentStage) {
        case 'vehicles':
            navVehicles.classList.add('active');
            progressWidth = '14%';
            break;
        case 'drivers':
            navVehicles.classList.add('active');
            navIconVehicles.style.display = 'inline'; // Mark Vehicles as completed
            navDrivers.classList.add('active');
            progressWidth = '28%';
            break;
        // Update cases for additional stages
        default:
            break;
    }

    // Update progress bar
    progressBar.style.width = progressWidth;
}

// Set up navigation link event listeners
function setupNavigation() {
    navVehicles.addEventListener('click', (e) => {
        e.preventDefault();
        showStage('vehicles');
        scrollToTop();
    });

    navDrivers.addEventListener('click', (e) => {
        e.preventDefault();
        if (navIconVehicles.style.display === 'inline') {
            // Only allow navigation to Drivers stage if Vehicles stage is completed
            showStage('drivers');
            scrollToTop();
        } else {
            alert('Please complete the Vehicles stage first.');
        }
    });

    // Add event listeners for additional nav links as needed
}

// Function to scroll to the top of the page
function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.addEventListener('DOMContentLoaded', () => {
    // Show the Vehicles stage initially
    showStage('vehicles');

    // Set up navigation links
    setupNavigation();

    // ... your existing code ...
});

    // Dynamically populate year dropdown for the vehicle
    const currentYear = new Date().getFullYear();
    const yearDropdown = document.getElementById('vehicle-year');
    for (let year = currentYear; year >= 1986; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearDropdown.appendChild(option);
    }

    // Fetch car data from JSON
    fetch('car-data.json')
        .then(response => response.json())
        .then(dataResponse => {
            carData = dataResponse; // Store car data for reuse
            const makeDropdown = document.getElementById('vehicle-make');
            const modelDropdown = document.getElementById('vehicle-model');
            const mainDoneIcon = document.getElementById('main-done-icon');
            const step2 = document.getElementById('step-2');
            const step3 = document.getElementById('step-3');

            // Populate the make dropdown
            for (const make in carData) {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                makeDropdown.appendChild(option);
            }

            // Hide the next step button initially
            nextStepButtonVehicles.classList.remove('show');

            // Show fade-in effect for next question and show done icon
            yearDropdown.addEventListener('change', () => {
                if (yearDropdown.value) {
                    step2.classList.add('active');
                    data.vehicle1.year = yearDropdown.value;
                    scrollToElement(step2); // Scroll to step2 when it becomes active
                }
            });

            makeDropdown.addEventListener('change', () => {
                if (makeDropdown.value) {
                    step3.classList.add('active');
                    data.vehicle1.make = makeDropdown.value;
                    modelDropdown.innerHTML = '<option value="">Select Vehicle Model</option>';
                    const selectedMake = makeDropdown.value;
                    carData[selectedMake].models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        modelDropdown.appendChild(option);
                    });
                    scrollToElement(step3); // Scroll to step3 when it becomes active
                }
            });

            modelDropdown.addEventListener('change', () => {
                if (modelDropdown.value) {
                    mainDoneIcon.style.display = 'inline-block';
                    data.vehicle1.model = modelDropdown.value;
                    showFirstQuestion(); // Load and show the dynamic questions
                }
            });
        })
        .catch(error => console.error('Error fetching car data:', error));

    // Load dynamic questions after selecting vehicle
    function showFirstQuestion() {
        fetch('stage-one-questions.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(dataResponse => {
                questionsData = dataResponse; // Store data for later use
                const questionsContainer = document.getElementById('questions-container');
                questionsContainer.innerHTML = ''; // Clear any previous questions

                // Replace placeholders in question texts for vehicle1
                const vehicle1Make = data.vehicle1.make || '';
                const vehicle1Model = data.vehicle1.model || '';
                const updatedQuestions = questionsData.questions.map(question => {
                    const updatedQuestion = { ...question };
                    if (question.id <= 7) {
                        updatedQuestion.questionText = question.question.replace(/{make}/g, vehicle1Make).replace(/{model}/g, vehicle1Model);
                    } else {
                        updatedQuestion.questionText = question.question; // Will be replaced for vehicle2 later
                    }
                    return updatedQuestion;
                });

                // Iterate through each question in the JSON
                updatedQuestions.forEach((question, index) => {
                    const questionWrapper = document.createElement('div');
                    questionWrapper.classList.add('question-step');
                    questionWrapper.setAttribute('data-step', index);
                    questionWrapper.setAttribute('data-id', question.id); // Add data-id attribute

                    const questionTitle = document.createElement('h2');
                    questionTitle.classList.add('question-title');
                    const questionText = question.questionText;
                    questionTitle.innerHTML = `<div class="done-icon" style="display: none;"></div> ${questionText}`;

                    const optionsContainer = document.createElement('div');
                    optionsContainer.classList.add('question-options');

                    question.choices.forEach(choice => {
                        const optionWrapper = document.createElement('label');
                        optionWrapper.classList.add('radio-button');

                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.name = `question_${question.id}`;
                        input.value = choice;

                        const radioCircle = document.createElement('span');
                        optionWrapper.appendChild(input);
                        optionWrapper.appendChild(radioCircle);

                        const label = document.createElement('span');
                        label.classList.add('radio-label');
                        label.textContent = choice;
                        optionWrapper.appendChild(label);

                        optionsContainer.appendChild(optionWrapper);

                        // Event listener to show the next question
                        input.addEventListener('change', () => {
                            const radioButtons = document.querySelectorAll(`input[name="question_${question.id}"]`);
                            radioButtons.forEach(rb => rb.parentElement.classList.remove('selected'));
                            optionWrapper.classList.add('selected');
                            questionTitle.querySelector('.done-icon').style.display = 'inline-block';

                            // Store the answer with question text as key
                            data.answers1[questionText] = input.value;

                            // Check if the current question is "Want to add a second vehicle?"
                            if (questionText.toLowerCase().includes('want to add a second vehicle')) {
                                handleSecondVehicleChoice(input.value);
                            } else {
                                // Show next question
                                const nextQuestion = document.querySelector(`[data-step="${index + 1}"]`);
                                if (nextQuestion) {
                                    nextQuestion.classList.add('active');
                                    scrollToElement(nextQuestion); // Scroll to the next question
                                } else {
                                    // No more questions, show next step button
                                    nextStepButtonVehicles.classList.add('show');
                                    scrollToElement(nextStepButtonVehicles); // Scroll to the next step button
                                }
                            }
                        });
                    });

                    questionWrapper.appendChild(questionTitle);
                    questionWrapper.appendChild(optionsContainer);
                    questionsContainer.appendChild(questionWrapper);
                });

                // Show first question
                const firstQuestion = document.querySelector('[data-step="0"]');
                if (firstQuestion) {
                    firstQuestion.classList.add('active');
                    scrollToElement(firstQuestion); // Scroll to the first question
                }

                // Hide the next step button initially
                nextStepButtonVehicles.classList.remove('show');
            })
            .catch(error => {
                console.error('Error fetching questions:', error);
                alert('Sorry, we are unable to load the questions at this time. Please try again later.');
            });
    }

    // Function to handle "Want to add a second vehicle?" logic
    function handleSecondVehicleChoice(answer) {
        if (answer === 'Yes') {
            // Initialize data.vehicle2 and data.answers2
            data.vehicle2 = {};
            data.answers2 = {};

            // Check if the second vehicle form already exists to avoid duplicates
            if (!document.getElementById('vehicle-form-2')) {
                repeatVehicleForm(); // Add the second "Let's get started" section for the second vehicle
            }
            nextStepButtonVehicles.classList.remove('show'); // Hide the Next Step button until the second vehicle questions are answered

            // Scroll to the second vehicle form
            setTimeout(() => {
                const vehicleForm2 = document.getElementById('vehicle-form-2');
                if (vehicleForm2) {
                    scrollToElement(vehicleForm2);
                }
            }, 500); // Delay to ensure the form is added to the DOM

        } else if (answer === 'No') {
            // Reset the second vehicle form and related questions
            removeSecondVehicleForm(); // Removes the second car form if exists
            hideSecondVehicleQuestions(); // Hides all the second car questions
            nextStepButtonVehicles.classList.add('show'); // Show the next step button once second car is removed
            scrollToElement(nextStepButtonVehicles); // Scroll to the next step button
        } else {
            alert('Invalid selection. Please choose "Yes" or "No".');
        }
    }

    // Function to repeat the vehicle form for a second car
    function repeatVehicleForm() {
        const currentCar = 2; // This is the second car

        // Clone the original vehicle form
        const vehicleForm = document.getElementById('vehicle-form');
        const clonedForm = vehicleForm.cloneNode(true); // Clone the form
        clonedForm.id = `vehicle-form-${currentCar}`; // Assign unique ID to the cloned form

        // Update the form title
        const formTitle = clonedForm.querySelector('h2');
        formTitle.innerHTML = `<div class="done-icon" id="main-done-icon-${currentCar}" style="display:none;"></div> Let's get started, what car do you drive? (Car ${currentCar})`;

        // Reset fields in the cloned form
        clonedForm.querySelectorAll('select').forEach(select => select.value = '');

        // Update IDs and names in the cloned form
        clonedForm.querySelectorAll('select').forEach(select => {
            const originalId = select.id.replace(`-${currentCar - 1}`, '');
            select.id = `${originalId}-${currentCar}`;
            select.name = `${select.name}-${currentCar}`;

            // Update corresponding labels
            const label = clonedForm.querySelector(`label[for="${originalId}"]`);
            if (label) {
                label.setAttribute('for', select.id);
            }
        });

        // Update IDs of steps
        let step2 = clonedForm.querySelector('#step-2');
        let step3 = clonedForm.querySelector('#step-3');

        step2.id = `step-2-${currentCar}`;
        step3.id = `step-3-${currentCar}`;

        // Update references to steps
        const step2New = clonedForm.querySelector(`#step-2-${currentCar}`);
        const step3New = clonedForm.querySelector(`#step-3-${currentCar}`);

        // Hide steps initially
        step2New.classList.remove('active');
        step3New.classList.remove('active');

        // Reattach event listeners to the cloned elements
        const yearDropdown2 = clonedForm.querySelector(`#vehicle-year-${currentCar}`);
        const makeDropdown2 = clonedForm.querySelector(`#vehicle-make-${currentCar}`);
        const modelDropdown2 = clonedForm.querySelector(`#vehicle-model-${currentCar}`);
        const mainDoneIcon2 = clonedForm.querySelector(`#main-done-icon-${currentCar}`);

        // Populate year dropdown
        const currentYear = new Date().getFullYear();
        yearDropdown2.innerHTML = '<option value="">Select Vehicle Year</option>';
        for (let year = currentYear; year >= 1986; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearDropdown2.appendChild(option);
        }

        // Populate make dropdown
        if (carData) {
            populateMakeDropdown(makeDropdown2, carData);
        } else {
            fetch('car-data.json')
                .then(response => response.json())
                .then(dataResponse => {
                    carData = dataResponse;
                    populateMakeDropdown(makeDropdown2, carData);
                })
                .catch(error => console.error('Error fetching car data:', error));
        }

        function populateMakeDropdown(makeDropdown, carData) {
            makeDropdown.innerHTML = '<option value="">Select Vehicle Make</option>';
            for (const make in carData) {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                makeDropdown.appendChild(option);
            }
        }

        // Event listeners for the cloned form
        yearDropdown2.addEventListener('change', () => {
            if (yearDropdown2.value) {
                step2New.classList.add('active');
                data.vehicle2.year = yearDropdown2.value;
                scrollToElement(step2New); // Scroll to step2 when it becomes active
            }
        });

        makeDropdown2.addEventListener('change', () => {
            if (makeDropdown2.value) {
                step3New.classList.add('active');
                data.vehicle2.make = makeDropdown2.value;
                modelDropdown2.innerHTML = '<option value="">Select Vehicle Model</option>';
                const selectedMake = makeDropdown2.value;
                carData[selectedMake].models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelDropdown2.appendChild(option);
                });
                scrollToElement(step3New); // Scroll to step3 when it becomes active
            }
        });

        modelDropdown2.addEventListener('change', () => {
            if (modelDropdown2.value) {
                mainDoneIcon2.style.display = 'inline-block';
                data.vehicle2.model = modelDropdown2.value;
                // Now show the second vehicle questions
                const secondVehicleQuestions = questionsData.questions.filter(q => q.id >= 8);
                showSecondVehicleQuestions(secondVehicleQuestions);
            }
        });

        // Insert the cloned form directly after the "Want to add a second vehicle?" question
        const secondVehicleQuestion = document.querySelector(`[data-id="7"]`); // Use data-id instead of data-step
        if (secondVehicleQuestion) {
            secondVehicleQuestion.insertAdjacentElement('afterend', clonedForm);
            scrollToElement(clonedForm); // Scroll to the cloned form when it's inserted
        } else {
            console.error('Second vehicle question not found.');
        }
    }

    // Function to show second vehicle questions
    function showSecondVehicleQuestions(questions) {
        // Find the cloned form
        const clonedForm = document.getElementById('vehicle-form-2');
        if (!clonedForm) {
            console.error('Cloned form not found');
            return;
        }

        // Create a container for the second vehicle questions
        const secondVehicleQuestionsContainer = document.createElement('div');
        secondVehicleQuestionsContainer.id = 'second-vehicle-questions-container';

        // Replace placeholders in question texts for vehicle2
        const vehicle2Make = data.vehicle2.make || '';
        const vehicle2Model = data.vehicle2.model || '';
        const updatedQuestions = questions.map(question => {
            const updatedQuestion = { ...question };
            updatedQuestion.questionText = question.question.replace(/{make}/g, vehicle2Make).replace(/{model}/g, vehicle2Model);
            return updatedQuestion;
        });

        // Add second vehicle questions below the new form
        updatedQuestions.forEach((question, index) => {
            const questionWrapper = document.createElement('div');
            questionWrapper.classList.add('question-step');
            questionWrapper.setAttribute('data-id', question.id); // Use data-id for identification

            const questionTitle = document.createElement('h2');
            questionTitle.classList.add('question-title');
            const questionText = question.questionText;
            questionTitle.innerHTML = `<div class="done-icon" style="display: none;"></div> ${questionText}`;

            const optionsContainer = document.createElement('div');
            optionsContainer.classList.add('question-options');

            question.choices.forEach(choice => {
                const optionWrapper = document.createElement('label');
                optionWrapper.classList.add('radio-button');

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question_${question.id}`;
                input.value = choice;

                const radioCircle = document.createElement('span');
                optionWrapper.appendChild(input);
                optionWrapper.appendChild(radioCircle);

                const label = document.createElement('span');
                label.classList.add('radio-label');
                label.textContent = choice;
                optionWrapper.appendChild(label);

                optionsContainer.appendChild(optionWrapper);

                // Event listener to show the next question
                input.addEventListener('change', () => {
                    const radioButtons = secondVehicleQuestionsContainer.querySelectorAll(`input[name="question_${question.id}"]`);
                    radioButtons.forEach(rb => rb.parentElement.classList.remove('selected'));
                    optionWrapper.classList.add('selected');
                    questionTitle.querySelector('.done-icon').style.display = 'inline-block';

                    // Store the answer with question text as key
                    data.answers2[questionText] = input.value;

                    // Show next question
                    const nextQuestion = secondVehicleQuestionsContainer.querySelector(`[data-id="${question.id + 1}"]`);
                    if (nextQuestion) {
                        nextQuestion.classList.add('active');
                        scrollToElement(nextQuestion); // Scroll to the next question
                    } else {
                        // Last question answered, show next step button
                        nextStepButtonVehicles.classList.add('show');
                        scrollToElement(nextStepButtonVehicles); // Scroll to the next step button
                    }
                });
            });

            questionWrapper.appendChild(questionTitle);
            questionWrapper.appendChild(optionsContainer);
            secondVehicleQuestionsContainer.appendChild(questionWrapper);
        });

        // Insert the second vehicle questions container after the cloned form
        clonedForm.insertAdjacentElement('afterend', secondVehicleQuestionsContainer);

        // Initially hide all questions
        secondVehicleQuestionsContainer.querySelectorAll('.question-step').forEach(q => q.classList.remove('active'));

        // Show the first second vehicle question
        const firstQuestion = secondVehicleQuestionsContainer.querySelector('.question-step');
        if (firstQuestion) {
            firstQuestion.classList.add('active');
            scrollToElement(firstQuestion); // Scroll to the first question
        }
    }

    // Function to remove the second vehicle form
    function removeSecondVehicleForm() {
        const secondVehicleForm = document.getElementById('vehicle-form-2');
        if (secondVehicleForm) {
            secondVehicleForm.remove(); // Remove the second car form
        }
        hideSecondVehicleQuestions(); // Also remove the second vehicle questions
        // Clear second vehicle data
        delete data.vehicle2;
        delete data.answers2;
    }

    // Function to hide second vehicle questions
    function hideSecondVehicleQuestions() {
        const secondVehicleQuestionsContainer = document.getElementById('second-vehicle-questions-container');
        if (secondVehicleQuestionsContainer) {
            secondVehicleQuestionsContainer.remove();
        }
    }

    nextStepButtonVehicles.addEventListener('click', () => {
    // Update the navigation bar
    navVehicles.classList.add('active');
    navIconVehicles.style.display = 'inline'; // Show done icon

    // Proceed to the Drivers stage
    showStage('drivers');
    scrollToTop();
});

    // After the user clicks the "Next Step" button
nextStepButton.addEventListener('click', () => {
    // Update the navigation bar
    markVehiclesStageCompleted();

    // Proceed to the next step or navigate to the next page
    // For now, we'll log the collected data
    console.log('Collected Data:', JSON.stringify(data, null, 2));
    // Here, you can redirect to the next page or handle the next stage
});

// Function to update the navigation bar
function markVehiclesStageCompleted() {
    const navVehicles = document.getElementById('nav-vehicles');
    const navIconVehicles = document.getElementById('nav-icon-vehicles');

    // Add the 'active' class to the 'Vehicles' link
    navVehicles.classList.add('active');

    // Show the done icon
    navIconVehicles.style.display = 'inline';

    // Optionally, you can update the progress bar width
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = '28%'; // Update as per your progress logic
}


// Drivers Stage JavaScript

// Function to validate name inputs
function validateName() {
    const firstName = firstNameInput.value.trim();
    const lastName = lastNameInput.value.trim();

    let isValid = true;

    // Simple validation checks
    if (firstName === '') {
        isValid = false;
        firstNameInput.classList.add('error');
    } else {
        firstNameInput.classList.remove('error');
    }

    if (lastName === '') {
        isValid = false;
        lastNameInput.classList.add('error');
    } else {
        lastNameInput.classList.remove('error');
    }

    if (isValid) {
        // Store the name data
        data.driver.firstName = firstName;
        data.driver.lastName = lastName;

        // Show the done icon
        nameDoneIcon.style.display = 'inline-block';

        // Show the Date of Birth form
        dobForm.style.display = 'block';
        scrollToElement(dobForm); // Scroll to the DOB form

        // Optionally, hide the Next Step button until DOB is filled
        nextStepButtonDrivers.classList.remove('show');
    } else {
        // Hide the done icon and DOB form
        nameDoneIcon.style.display = 'none';
        dobForm.style.display = 'none';
        nextStepButtonDrivers.classList.remove('show');
    }
}
// Event listeners for name inputs
[firstNameInput, lastNameInput].forEach(input => {
    input.addEventListener('input', () => {
        // Validate the inputs
        validateName();
    });

    // Remove error class on focus
    input.addEventListener('focus', () => {
        input.classList.remove('error');
    });
});


// Get elements for the Drivers stage
const dobForm = document.getElementById('dob-form');
const dobMonth = document.getElementById('dob-month');
const dobDay = document.getElementById('dob-day');
const dobYear = document.getElementById('dob-year');
const dobDoneIcon = document.getElementById('dob-done-icon');

// Function to validate date of birth
function validateDOB() {
    const month = dobMonth.value.trim();
    const day = dobDay.value.trim();
    const year = dobYear.value.trim();

    let isValid = true;

    // Simple validation checks
    if (!/^\d{2}$/.test(month) || parseInt(month) < 1 || parseInt(month) > 12) {
        isValid = false;
        dobMonth.classList.add('error');
    } else {
        dobMonth.classList.remove('error');
    }

    if (!/^\d{2}$/.test(day) || parseInt(day) < 1 || parseInt(day) > 31) {
        isValid = false;
        dobDay.classList.add('error');
    } else {
        dobDay.classList.remove('error');
    }

    if (!/^\d{4}$/.test(year) || parseInt(year) < 1900 || parseInt(year) > new Date().getFullYear()) {
        isValid = false;
        dobYear.classList.add('error');
    } else {
        dobYear.classList.remove('error');
    }

    if (isValid) {
        // Additional validation for valid date
        const dateString = `${year}-${month}-${day}`;
        const date = new Date(dateString);
        if (date.getFullYear() !== parseInt(year) || date.getMonth() + 1 !== parseInt(month) || date.getDate() !== parseInt(day)) {
            isValid = false;
            dobMonth.classList.add('error');
            dobDay.classList.add('error');
            dobYear.classList.add('error');
        } else {
            dobMonth.classList.remove('error');
            dobDay.classList.remove('error');
            dobYear.classList.remove('error');
        }
    }

    if (isValid) {
        // Store the date of birth
        data.driver.dateOfBirth = dateString;

        // Show the done icon
        dobDoneIcon.style.display = 'inline-block';

        // Show the next step button
        nextStepButtonDrivers.classList.add('show');
    } else {
        // Hide the done icon and next step button
        dobDoneIcon.style.display = 'none';
        nextStepButtonDrivers.classList.remove('show');
    }
}

// Event listeners for input fields
// Event listeners for DOB input fields
[dobMonth, dobDay, dobYear].forEach(input => {
    input.addEventListener('input', () => {
        // Move focus to next input when max length is reached
        if (input.value.length === input.maxLength) {
            if (input === dobMonth) {
                dobDay.focus();
            } else if (input === dobDay) {
                dobYear.focus();
            } else if (input === dobYear) {
                input.blur(); // Optionally, blur the input when done
            }
        }

        // Validate the inputs
        validateDOB();
    });

    // Remove error class on focus
    input.addEventListener('focus', () => {
        input.classList.remove('error');
    });
});



// Next Step Button Click Handler for Drivers Stage
nextStepButtonDrivers.addEventListener('click', () => {
    // Update the navigation bar
    navDrivers.classList.add('active');

    // Create and show the done icon if it doesn't exist
    if (!navIconDrivers) {
        navIconDrivers = document.createElement('span');
        navIconDrivers.classList.add('nav-icon');
        navIconDrivers.id = 'nav-icon-drivers';
        navIconDrivers.textContent = '✔';
        navDrivers.insertBefore(navIconDrivers, navDrivers.firstChild);
    }
    navIconDrivers.style.display = 'inline';

    // Proceed to the next stage (e.g., Final Details)
    // For now, we'll log the collected data
    console.log('Collected Data:', JSON.stringify(data, null, 2));

    // Show the next stage (implement similar to previous stages)
    // showStage('final-details');
});



// Event listener for the 'Vehicles' link to navigate back to the current page
const navVehiclesLink = document.getElementById('nav-vehicles');
navVehiclesLink.addEventListener('click', (e) => {
    e.preventDefault(); // Prevent default link behavior
    // Since we're already on the Vehicles page, we can scroll to the top or reload
    window.scrollTo({ top: 0, behavior: 'smooth' });
    // Or, if you have sections, you can scroll to the Vehicles section
});

</script>






</body>
</html>
